<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Typing Speed Test</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0f0f, #1c1c1c);
      color: white;
    } 
    .container {
      max-width: 800px;
      margin: 40px auto;
      padding: 30px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }
    input, textarea, button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    input, textarea {
      background: #333;
      color: white;
    }
    button {
      background-color: #00b894;
      color: white;
      cursor: pointer;
    }
    #finalSubmitBtn {
      display: none;
      background-color: #0984e3;
    }
    .error {
      color: red;
      font-size: 14px;
      display: none;
    }
    .results {
      margin-top: 20px;
      background-color: #2d3436;
      padding: 15px;
      border-radius: 5px;
    }
    .timer {
      text-align: right;
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    #paragraph {
      background-color: #222;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üñã Typing Speed Test</h2>
    
    <div id="user-info">
      <label>Name <span style="color:red">*</span></label>
      <input type="text" id="name" placeholder="Enter your name" />
      <div class="error" id="nameError">Please enter a valid name.</div>

      <label>Email <span style="color:red">*</span></label>
      <input type="email" id="email" placeholder="Enter your email" />
      <div class="error" id="emailError">Please enter a valid email.</div>

      <button onclick="startTyping()">Start Test</button>
    </div>

    <div id="test-area" style="display:none;">
      <div class="timer" id="timer">1:00</div>
      <div id="paragraph"></div>
      <textarea id="typing-box" disabled placeholder="Start typing here..."></textarea>
    </div>

    <div class="results" id="results" style="display:none;"></div>
    <button id="finalSubmitBtn" onclick="submitToSheet()">Submit</button>
  </div>

  <script>
    const paragraphs = [
      `Technology is evolving every second, and those who stay ahead of the curve are the ones who shape the future. Stay curious, keep building your skills, and don't be afraid to make mistakes. Every failure teaches a new lesson. Success is nothing but a stack of failures you stood on.`
    ];

    let totalDuration = 60;
    let timeLeft = totalDuration;
    let activeTimer;
    let inactivityTimer;
    let timerRunning = false;

    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      document.getElementById("timer").innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function startMainTimer() {
      if (timerRunning) return;
      timerRunning = true;
      activeTimer = setInterval(() => {
        if (timeLeft <= 0) {
          clearInterval(activeTimer);
          finishTest();
          return;
        }
        timeLeft--;
        updateTimerDisplay();
      }, 1000);
    }

    function pauseMainTimer() {
      clearInterval(activeTimer);
      timerRunning = false;
    }

    function startTyping() {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const nameRegex = /^[a-zA-Z ]+$/;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      let valid = true;
      if (!nameRegex.test(name)) {
        document.getElementById("nameError").style.display = "block";
        valid = false;
      } else {
        document.getElementById("nameError").style.display = "none";
      }
      if (!emailRegex.test(email)) {
        document.getElementById("emailError").style.display = "block";
        valid = false;
      } else {
        document.getElementById("emailError").style.display = "none";
      }

      if (!valid) return;

      document.getElementById("user-info").style.display = "none";
      document.getElementById("test-area").style.display = "block";

      document.getElementById("paragraph").innerText = paragraphs[0];
      const typingBox = document.getElementById("typing-box");
      typingBox.disabled = false;
      typingBox.focus();
      timeLeft = totalDuration;
      updateTimerDisplay();

      typingBox.addEventListener("input", () => {
        clearTimeout(inactivityTimer);
        startMainTimer();
        inactivityTimer = setTimeout(() => pauseMainTimer(), 3000);
      });
    }

    function finishTest() {
      pauseMainTimer();
      const typedText = document.getElementById("typing-box").value.trim();
      const originalText = paragraphs[0];
      const typedWords = typedText.split(/\s+/);
      const originalWords = originalText.split(/\s+/);

      let correct = 0;
      typedWords.forEach((word, i) => {
        if (word === originalWords[i]) correct++;
      });

      const wpm = Math.round((typedWords.length / totalDuration) * 60);
      const accuracy = ((correct / originalWords.length) * 100).toFixed(2);

      document.getElementById("typing-box").disabled = true;
      document.getElementById("test-area").style.display = "none";

      document.getElementById("results").innerHTML = `
        <h3>Test Result</h3>
        <p><strong>WPM:</strong> ${wpm}</p>
        <p><strong>Accuracy:</strong> ${accuracy}%</p>
        <p><strong>Total Words Typed:</strong> ${typedWords.length}</p>
        <p><strong>Correct Words:</strong> ${correct}</p>
        <p><strong>User:</strong> ${document.getElementById("name").value} (${document.getElementById("email").value})</p>
      `;
      document.getElementById("results").style.display = "block";
      document.getElementById("finalSubmitBtn").style.display = "block";

      // Store for submit
      window.resultData = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        wpm,
        accuracy,
        totalWords: typedWords.length,
        correctWords: correct
      };
    }

   function submitToSheet() {
  fetch("https://script.google.com/macros/s/AKfycbyGB3OyCcTIU3kK3KV_3srQlhw3hY1oNc19CZa-EgQOYK1srx2wSPdCUV4SnEhNj1i8/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(window.resultData) 
  })
  .then(res => res.text())
  .then(data => {
    alert("‚úÖ Submitted Successfully!");
    location.reload();
  })
  .catch(err => {
    console.error("‚ùå Submission failed:", err);
    alert("Failed to submit. Try again.");
  });
}

  </script>
</body>
</html>
