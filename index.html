<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Typing Test with Auto Pause Timer</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      background: linear-gradient(135deg, #0f0f0f, #1c1c1c);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 40px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      margin-top: 50px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    h2 {
      text-align: center;
    }
    label, input {
      display: block;
      width: 100%;
      margin-bottom: 15px;
      font-size: 16px;
    }
    input {
      padding: 10px;
      border-radius: 8px;
      border: none;
      outline: none;
      background: #333;
      color: #fff;
    }
    .error {
      color: #ff4d4d;
      margin-bottom: 10px;
      display: none;
    }
    #paragraph {
      background: #222;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 16px;
      line-height: 1.6;
    }
    textarea {
      width: 100%;
      height: 150px;
      font-size: 16px;
      padding: 10px;
      border-radius: 10px;
      background: #333;
      color: white;
      border: none;
      resize: none;
      outline: none;
    }
    button {
      background: #00b894;
      border: none;
      padding: 12px 20px;
      color: white;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    #finalSubmitBtn {
      display: none;
      background-color: #0984e3;
      margin-top: 20px;
      transition: 0.3s ease;
    }
    #finalSubmitBtn:hover {
      background-color: #74b9ff;
    }
    .timer {
      text-align: right;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .results {
      background: #2d3436;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }
    .results p {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üñã Typing Speed Test</h2>

    <div id="user-info">
      <label for="name">Name <span style="color:red">*</span></label>
      <input type="text" id="name" placeholder="Enter your name">
      <div id="nameError" class="error">Please enter a valid name (letters only).</div>

      <label for="email">Email <span style="color:red">*</span></label>
      <input type="email" id="email" placeholder="Enter your email">
      <div id="emailError" class="error">Please enter a valid email address.</div>

      <button onclick="startTyping()">Start Test</button>
    </div>

    <div id="test-area" style="display:none;">
      <div class="timer" id="timer">1:00</div>
      <div id="paragraph"></div>
      <textarea id="typing-box" disabled placeholder="Start typing here..."></textarea>
    </div>

    <div class="results" id="results" style="display:none;"></div>
    <button id="finalSubmitBtn" onclick="submitToSheet()">Submit</button>
  </div>

  <script>
    const paragraphs = [
      `Technology is evolving every second, and those who stay ahead of the curve are the ones who shape the future. Stay curious, keep building your skills, and don't be afraid to make mistakes. Every failure teaches a new lesson. Success is nothing but a stack of failures you stood on.`
    ];

    let currentParaIndex = 0;
    let totalDuration = 60;
    let timeLeft = totalDuration;
    let activeTimer;
    let inactivityTimer;
    let timerRunning = false;

    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      document.getElementById("timer").innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function startMainTimer() {
      if (timerRunning) return;
      timerRunning = true;
      activeTimer = setInterval(() => {
        if (timeLeft <= 0) {
          clearInterval(activeTimer);
          finishTest();
          return;
        }
        timeLeft--;
        updateTimerDisplay();
      }, 1000);
    }

    function pauseMainTimer() {
      clearInterval(activeTimer);
      timerRunning = false;
    }

    function startTyping() {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const nameRegex = /^[a-zA-Z ]+$/;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      let valid = true;
      if (!nameRegex.test(name)) {
        document.getElementById("nameError").style.display = "block";
        valid = false;
      } else {
        document.getElementById("nameError").style.display = "none";
      }
      if (!emailRegex.test(email)) {
        document.getElementById("emailError").style.display = "block";
        valid = false;
      } else {
        document.getElementById("emailError").style.display = "none";
      }
      if (!valid) return;

      document.getElementById("user-info").style.display = "none";
      document.getElementById("test-area").style.display = "block";
      document.getElementById("paragraph").innerText = paragraphs[currentParaIndex];
      const typingBox = document.getElementById("typing-box");
      typingBox.disabled = false;
      typingBox.focus();

      timeLeft = totalDuration;
      updateTimerDisplay();

      typingBox.addEventListener("input", () => {
        clearTimeout(inactivityTimer);
        startMainTimer();

        inactivityTimer = setTimeout(() => {
          pauseMainTimer();
        }, 3000);
      });
    }

    function finishTest() {
      pauseMainTimer();
      document.getElementById("typing-box").disabled = true;
      const typedText = document.getElementById("typing-box").value.trim();
      const originalText = paragraphs[currentParaIndex];
      const typedWords = typedText.split(/\s+/);
      const originalWords = originalText.split(/\s+/);

      let correct = 0;
      typedWords.forEach((word, i) => {
        if (word === originalWords[i]) correct++;
      });

      const wpm = Math.round((typedWords.length / totalDuration) * 60);
      const accuracy = ((correct / originalWords.length) * 100).toFixed(2);

      const resultBox = document.getElementById("results");
      resultBox.innerHTML = `
        <h3>Test Result</h3>
        <p><strong>WPM:</strong> ${wpm}</p>
        <p><strong>Accuracy:</strong> ${accuracy}%</p>
        <p><strong>Total Words Typed:</strong> ${typedWords.length}</p>
        <p><strong>Correct Words:</strong> ${correct}</p>
        <p><strong>Paragraph:</strong> ${currentParaIndex + 1}/1</p>
        <p><strong>User:</strong> ${document.getElementById("name").value} (${document.getElementById("email").value})</p>
      `;

      resultBox.style.display = 'block';
      document.getElementById("finalSubmitBtn").style.display = "inline-block";

      // Save for final submit
      window.resultData = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        wpm: wpm,
        accuracy: accuracy,
        totalWords: typedWords.length,
        correctWords: correct
      };

      document.getElementById("test-area").style.display = "none";
    }

    function submitToSheet() {
      fetch("https://script.google.com/macros/s/AKfycbz1DbXyee9LjxRBOiL9yt9wTdRR-VOFw51snNxa3rWOLMTtU__RL_WqSXeGVv4HJYwB/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(window.resultData)
      })
      .then(response => response.text())
      .then(data => {
        alert("‚úÖ Your result has been submitted!");
        document.getElementById("user-info").style.display = "block";
        document.getElementById("results").style.display = "none";
        document.getElementById("finalSubmitBtn").style.display = "none";
        document.getElementById("name").value = "";
        document.getElementById("email").value = "";
        document.getElementById("typing-box").value = "";
      })
      .catch(error => {
        console.error("‚ùå Error submitting to Google Sheet:", error);
        alert("Error! Please try again.");
      });
    }
  </script>
</body>
</html>
