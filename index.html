<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Typing Speed Test</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0f0f, #1c1c1c);
      color: white;
    }
    .container {
      max-width: 800px;
      margin: 40px auto;
      padding: 30px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }
    input, textarea, button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    textarea {
      background: #333;
      color: white;
      height: 200px;
    }
    input {
      background: #333;
      color: white;
    }
    button {
      background-color: #00b894;
      color: white;
      cursor: pointer;
    }
    #finalSubmitBtn {
      display: none;
      background-color: #0984e3;
    }
    .error {
      color: red;
      font-size: 14px;
      display: none;
    }
    .results {
      margin-top: 20px;
      background-color: #2d3436;
      padding: 15px;
      border-radius: 5px;
    }
    .timer {
      text-align: right;
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    #paragraph {
      background-color: #222;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      line-height: 1.6;
      white-space: pre-wrap;
    }
    .highlight {
      background-color: #00b894;
      color: black;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2> 🖋 Typing Speed Test</h2>

    <div id="user-info">
      <label>Name <span style="color:red">*</span></label>
      <input type="text" id="name" placeholder="Enter your name" />
      <div class="error" id="nameError">Please enter a valid name.</div>

      <label>Email <span style="color:red">*</span></label>
      <input type="email" id="email" placeholder="Enter your email" />
      <div class="error" id="emailError">Please enter a valid email.</div>

      <button id="startBtn" onclick="startTyping()">Start Test</button>
    </div>

    <div id="test-area" style="display:none;">
      <div class="timer" id="timer">1:00</div>
      <div id="paragraph"></div>
      <textarea id="typing-box" disabled placeholder="Start typing here..."></textarea>
    </div>

    <div class="results" id="results" style="display:none;"></div>
    <button id="finalSubmitBtn" onclick="submitToSheet()">Submit</button>
  </div>

  <script>
    const paragraphs = [
      "Typing helps you improve your focus, accuracy, and speed. Regular practice strengthens your ability to work on keyboards without looking.",
      "Discipline is the bridge between goals and achievement. Without consistent effort, even the most talented individuals may fail to reach their potential."
    ];

    let totalDuration = 60;
    let timeLeft = totalDuration;
    let timer;
    let selectedText = "";
    let resultData = {};

    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      document.getElementById("timer").innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function startTyping() {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const nameRegex = /^[a-zA-Z ]+$/;
      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;

      let valid = true;
      if (!nameRegex.test(name)) {
        document.getElementById("nameError").style.display = "block";
        valid = false;
      } else {
        document.getElementById("nameError").style.display = "none";
      }

      if (!emailRegex.test(email)) {
        document.getElementById("emailError").style.display = "block";
        valid = false;
      } else {
        document.getElementById("emailError").style.display = "none";
      }

      if (!valid) return;

      document.getElementById("user-info").style.display = "none";
      document.getElementById("test-area").style.display = "block";
      document.getElementById("typing-box").disabled = false;

      selectedText = paragraphs[Math.floor(Math.random() * paragraphs.length)];
      document.getElementById("paragraph").innerText = selectedText;
      document.getElementById("typing-box").focus();

      timeLeft = totalDuration;
      updateTimerDisplay();

      timer = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
          clearInterval(timer);
          finishTest();
        }
      }, 1000);
    }

    function finishTest() {
      clearInterval(timer);
      document.getElementById("typing-box").disabled = true;
      document.getElementById("test-area").style.display = "none";

      const typed = document.getElementById("typing-box").value.trim();
      const typedWords = typed.split(/\s+/);
      const originalWords = selectedText.split(/\s+/);

      let correct = 0;
      typedWords.forEach((w, i) => {
        if (w === originalWords[i]) correct++;
      });

      const wpm = Math.round((typedWords.length / totalDuration) * 60);
      const accuracy = ((correct / originalWords.length) * 100).toFixed(2);

      resultData = {
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
        wpm,
        accuracy,
        totalWords: typedWords.length,
        correctWords: correct
      };

      document.getElementById("results").innerHTML = `
        <h3>Test Result</h3>
        <p><strong>WPM:</strong> ${wpm}</p>
        <p><strong>Accuracy:</strong> ${accuracy}%</p>
        <p><strong>Total Words:</strong> ${typedWords.length}</p>
        <p><strong>Correct Words:</strong> ${correct}</p>
      `;
      document.getElementById("results").style.display = "block";
      document.getElementById("finalSubmitBtn").style.display = "block";
    }

    function submitToSheet() {
      const url = 'https://script.google.com/macros/s/AKfycbwfZ3gy5_fZC3TDZPRNHcCO_prl4KouN4hmp0diqeklu1t6NXdpXrQNEJeaX5NArA8/exec';

      fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(resultData)
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert("✅ Submitted Successfully!");
            window.location.reload();
          } else {
            alert("❌ Submission failed: " + data.error);
          }
        })
        .catch(error => {
          alert("❌ Error: " + error.message);
        });
    }

    // Enable Start button just in case it's stuck disabled
    window.onload = () => {
      document.getElementById("startBtn").disabled = false;
    };
  </script>
</body>
</html>
